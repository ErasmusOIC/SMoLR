---
title: "Introduction in Single Molecule Localization in R (SMolR)"
author: "Maarten Paul (m.w.paul@erasmusmc.nl) and Johan Slotman (j.slotman@erasmusmc.nl)"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{SMoLR}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---
```{r,cache=TRUE}
library(SMolR)
```

The SMolR package consists of a set of functions dedicated to quantitive analysis of Single Molecule Localization data in R.

- Importing and organizing large single molecule localization data sets
- Visualize super resolution localization data
- High-thoughput analysis of large data sets


## Import of localization data

Using `SMOLR_IMPORT` different types of data can be imported into R from a folder. The localizations from different ROIs or images are sorted in a `list` of `data.frame`'s. Different `profiles` are available to load different types of data.

```{r}
SMOLR_IMPORT(folder="../loc",profile = "roiloc")
SMOLR_LOAD(folder="../loc")
```

Example of localizations `data.frame`

```{r, echo=TRUE, results='asis'}
knitr::kable(head(localizations[[1]], 10))
```


## Visualization
The localizations can plotted by individual Gaussians using the `SMOLR` function. This can also be applied to a `list` of `data.frame's`. This will create an list of super resolution images. In this example a `data.frame` is the input. The plot function can be applied to the `SMOLR_image` object. This will return images of all channels in gray scale.

```{r, fig.show='hold',fig.height=3}
img <- SMOLR(smolrdata)
plot(img)
```

Alternatively an RGB image can be plotted.

```{r, fig.show='hold',fig.height=3}
plot(img,rgb=TRUE)
```

Instead of storing the data in R it is also possible to save an image as tiff.

```{r, eval = FALSE}
SMOLR(smolrdata)
```

```{r, fig.show='hold',fig.height=3}
plot(SMOLR(subset(smolrdata,Channel==1)))
```

Plotting localizations as scatter plot
```{r, fig.show='hold',fig.height=3}
SMOLR_PLOT(smolrdata)
```

Plotting channels separetely
```{r, fig.show='hold',fig.width=8}
SMOLR_PLOT(smolrdata,split_ch = T)
```

```{r, fig.show='hold',fig.width=8}
SMOLR_PLOT(smolrdata,split_ch = T,color = smolrdata$First_Frame)
```


\newpage 

## Clustering
```{r, fig.show='hold',fig.width=8}
plot(SMOLR_KDE(smolrdata))

```

Visualization of DBSCAN clustering. The colors indicate the assigned cluster, while the red localizations are considered background.
```{r, fig.show='hold',fig.width=8}
plot(SMOLR_DBSCAN(smolrdata,eps=50,MinPts=5))

```

## Features
```{r}
features <- SMOLR_FEATURES(SMOLR_KDE(smolrdata))
```

```{r, echo=TRUE, results='asis'}
knitr::kable(head(features$channel_1[,1:9], 10))
```

Or localization based features
```{r}
point_features <- SMOLR_POINT_FEATURES(SMOLR_DBSCAN(smolrdata,eps=50,MinPts=5))
```

```{r, echo=TRUE, results='asis'}
knitr::kable(head(point_features[,1:10], 10))
```